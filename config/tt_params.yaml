trajectory_tt_publisher:
  ros__parameters:
    publishRate: 100.0
    commandFrameId: command

    #################### Trajectory parameters ####################
    # Select the type of trajectory to publish. The parameters below will be used accordingly.
    trajectoryType: screw_move # target_pose, linear_move, screw_move, figure_eight
    duration: 5.0
    dt: 0.02
    timeScaling: min_jerk # linear, min_jerk (used by: target_pose, linear_move, screw_move)

    #################### Reference timing ####################
    # referenceTiming:
    #   - time: original time-indexed TT (default)
    #   - spatial_projection: retime trajectory so t_now aligns with the closest spatial waypoint
    referenceTiming: time # time, spatial_projection
    projectionWindow: 20
    projectionMaxBacktrack: 5

    #################### poseMoveTarget ####################
    # Move along a straight line in the global frame from the initial EE pose to a specified target pose.
    # [x, y, z] or [x, y, z, thz, thy, thx] or [x, y, z, qw, qx, qy, qz] [m, rad, or unitless]
    poseMoveTarget: [0.45, 0.2, 0.7, 0.707, 0.0, 0.0, -0.707] # [x, y, z, qw, qx, qy, qz]
    # poseMoveTarget: [0.6, 0.4, 0.9] # [x, y, z]
    # poseMoveTarget: [0.45, 0.2, 0.7, 0.0, 0.0, 0.0] # [x, y, z, thz, thy, thx]
    # poseMoveTarget: [] # empty -> stay at initial pose (no motion)

    #################### linearMoveOffset ####################
    # Move along a straight line in the global frame from the initial EE pose to an offset pose.
    # [x, y, z, thz, thy, thx] [m, rad]
    linearMoveOffset: [0.0, 0.0, 0.1, 0.0, 0.7854, 0.0]
    linearMoveOffsetInToolFrame: true

    #################### screw_move ####################
    # Relative 6D screw motion (body-screw): T(t) = T0 * exp([S] * theta(t))
    # u_hat: axis of rotation represented in EE frame (will be normalized)
    # r: axis->EE vector represented in EE frame (||r|| is the radius) [m]
    # theta: screw angle about the axis [rad]
    # S = [r x u_hat; u_hat] is the (body-)screw axis in se(3) represented in EE frame
    screwMoveUhat: [0.0, 1.0, 0.0]
    screwMoveR: [-0.2, 0.0, 0.0]
    # screwMoveUhat: [0.0, 0.0, 1.0]
    # screwMoveR: [0.05, 0.0, 0.0]
    screwMoveTheta: 1.57079632679 # +pi/2
    screwMoveInToolFrame: true

    #################### figure_eight ####################
    # Figure-eight trajectory in a plane.
    amplitude: 0.20
    frequency: 0.05
    axisX: 1.0
    axisY: 0.0
    axisZ: 1.0

    #################### Reactive delta pose ####################
    # Subscribe a reactive delta pose (PoseStamped) and add it to the nominal planned trajectory before publishing.
    # Leave topic empty ("") to disable.
    deltaPoseTopic: "/admittance_controller/delta_pose"
    deltaPoseInToolFrame: true
    deltaPoseTimeout: 0.5 # [sec] 0.0 -> never timeout (use last received delta forever)

    #################### Intervention and mode schedule/switching settings ####################
    # Intervention: on DIVERGED or FINISHED, publish a HOLD target at the current EE pose and stop TT publishing.
    interveneHoldOnDivergedOrFinished: true

    # Optional safety: publish a short burst of zero base cmd_vel on intervention/pause (no use in arm-only mode, but required for mobile manipulator).
    publishZeroBaseCmdOnIntervention: true
    baseCmdTopic: "/cmd_vel"
    zeroBaseCmdBurstCount: 10
    zeroBaseCmdBurstRate: 50.0

    # Optional: also switch the ros2_control controller on intervention/pause/resume via controller_manager.
    switchMpcControllerOnIntervention: false
    controllerManagerSwitchService: "/controller_manager/switch_controller"
    mpcControllerName: "mpc_controller"

    # Optional: publish a default OCS2 ModeSchedule before enabling MPC (so you don't have to manually `ros2 topic pub`).
    publishModeScheduleOnEnable: true
    modeScheduleMode: 1

trajectory_progress_monitor:
  ros__parameters:
    monitorRate: 100.0
    publishTF: true
    closestFrameId: command_closest
    window: 20
    maxBacktrack: 5

    onTrackPos: 0.005
    onTrackOriDeg: 5.0

    divergedPos: 0.03
    divergedHoldSec: 1.0

    finishProgress: 0.98
    finishPos: 0.005
